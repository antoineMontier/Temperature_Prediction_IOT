#include <Arduino.h>
#include <string.h>
#include <math.h>
#include "DHT.h"

/*
 Dirty single-file model runner.
 Model architecture:
  input: 48
  dense_4: 32  (activation: ReLU)
  dense_5: 16  (activation: ReLU)
  dense_6: 8   (activation: ReLU)
  dense_7: 1   (activation: linear)
 
*/

// sizes
#define IN_SZ 48
#define L0_SZ 32
#define L1_SZ 16
#define L2_SZ 8
#define OUT_SZ 1
#define DHTPIN 7
#define DHTTYPE DHT11
#define SAMPLING_INTERVAL 30 // min




DHT dht(DHTPIN, DHTTYPE);

int previous_temperature[IN_SZ];
int next_temperature    [IN_SZ];

int temp;

inline void applyColor (int r, int g, int b);

// Scaler parameters
static const float SCALER_MIN = -5.0f;
static const float SCALER_MAX = 25.0f;
static const float SCALER_RANGE = SCALER_MAX - SCALER_MIN;

// ---- placeholder weights/biases (row-major: weights[layer_out_index * in_size + in_index]) ---- // obtained from model_weights_extractor.py

// layer dense_4: kernel (32 x 48), bias (32)
static const float W_dense_4[1536] = { +1.94174752e-01f, +1.68859009e-02f, -2.48415202e-01f, -3.30679826e-02f, -2.48247936e-01f, -2.64938325e-01f, +2.45976150e-01f, +8.63572806e-02f, +2.86271125e-02f, +2.04796091e-01f, +1.54858962e-01f, -3.88294421e-02f, -1.33820459e-01f, -5.83717488e-02f, -7.99607486e-02f, +3.80292498e-02f, +9.97882187e-02f, +1.61844313e-01f, -2.79266178e-03f, -8.65504593e-02f, -1.88771337e-01f, -1.49125978e-01f, +4.47200201e-02f, +1.86252192e-01f, -1.52471080e-01f, +1.64715424e-02f, -2.47540668e-01f, -1.82789922e-01f, +1.99896097e-01f, -1.86379015e-01f, +2.21924216e-01f, -1.25971079e-01f, +1.50567159e-01f, +4.90808077e-02f, -1.42845824e-01f, -2.48195738e-01f, -1.12078026e-01f, +1.60241276e-01f, +1.24029092e-01f, -1.87383354e-01f, +1.62384942e-01f, -2.66705155e-01f, -2.39520557e-02f, +2.82258186e-02f, -5.71190231e-02f, -1.60504282e-01f, +2.07187161e-01f, -2.35917885e-02f, -3.14114839e-01f, +8.14431831e-02f, +2.03720585e-01f, -1.31721765e-01f, -7.53342658e-02f, +1.41616017e-01f, +1.07613854e-01f, +1.40617907e-01f, +9.32979882e-02f, +3.89167592e-02f, -2.81974804e-02f, -1.83478877e-01f, -2.61239350e-01f, -3.97899747e-02f, -2.12048486e-01f, +2.08653823e-01f, +1.08193867e-01f, +2.32151151e-01f, -1.86958283e-01f, +5.34298085e-02f, -1.64922848e-01f, -2.07176775e-01f, -6.29975647e-02f, -1.98896855e-01f, +2.00308293e-01f, +2.00161442e-01f, +4.33006398e-02f, +2.30394989e-01f, +3.91264223e-02f, +8.23928118e-02f, -8.01171586e-02f, -1.70017645e-01f, +2.08208427e-01f, +2.91380703e-01f, +2.67976433e-01f, -1.97195604e-01f, -5.54106124e-02f, -1.62843421e-01f, +9.83692482e-02f, -1.31207034e-01f, +1.49503618e-01f, +1.96682557e-01f, +2.47466639e-01f, +1.29936442e-01f, -9.96776223e-02f, +1.76200360e-01f, +4.34608996e-01f, +1.29885340e+00f, -4.99629751e-02f, +1.94994017e-01f, -1.57974139e-01f, +2.09657565e-01f, -1.62120163e-01f, +2.37834617e-01f, -1.55096039e-01f, -2.86120057e-01f, +1.86814927e-02f, -1.53162867e-01f, -4.24946807e-02f, -2.34676003e-01f, +2.38077432e-01f, +1.90254539e-01f, -1.05643459e-01f, -2.54491031e-01f, -9.37319100e-02f, +1.21623829e-01f, -9.07127336e-02f, +1.79111645e-01f, +1.32392198e-01f, +1.76474109e-01f, -2.59978056e-01f, -2.43198723e-01f, +1.66891083e-01f, -3.51212248e-02f, +8.74850526e-02f, +9.81427580e-02f, -2.73338020e-01f, +1.91498145e-01f, +1.35689139e-01f, +2.16532454e-01f, +9.18442309e-02f, +5.72231412e-02f, -2.73871392e-01f, +2.28575647e-01f, -2.96715021e-01f, -1.29799306e-01f, -1.11633663e-05f, +1.46535188e-01f, -2.75293589e-01f, -8.88299718e-02f, +1.79559454e-01f, -9.16911736e-02f, +7.03000324e-03f, -2.76319683e-01f, -2.76536196e-01f, -1.39982745e-01f, -1.05153672e-01f, +8.77145603e-02f, -2.76106924e-01f, +8.21226984e-02f, -6.68152198e-02f, +2.18615577e-01f, -1.86165906e-02f, -2.06783526e-02f, +2.12600514e-01f, +3.83697808e-01f, +3.18219423e-01f, +2.84450263e-01f, -1.47558153e-01f, -2.19843879e-01f, -5.15823849e-02f, +1.02399848e-01f, +1.82777524e-01f, +1.62610784e-01f, +2.30381712e-01f, -6.83502182e-02f, +1.45452484e-01f, -1.11494891e-01f, -2.47392565e-01f, -3.68493125e-02f, +1.56872913e-01f, -2.70538121e-01f, -6.53692111e-02f, -1.46667540e-01f, -2.72928715e-01f, +1.14118434e-01f, -1.46205351e-01f, -2.77448446e-01f, +2.08874658e-01f, +2.07369983e-01f, -2.36043081e-01f, +2.85633709e-02f, +9.21905041e-02f, -3.19664925e-01f, -8.42407197e-02f, -2.98711509e-01f, -1.24616913e-01f, -4.61621612e-01f, -2.22908393e-01f, -1.05006456e-01f, -2.25950718e-01f, -4.57798153e-01f, +1.86647013e-01f, +6.56663179e-01f, -2.71479875e-01f, +7.45168403e-02f, -2.07576632e-01f, +2.28284970e-01f, -2.39972189e-01f, +1.93018362e-01f, +3.55388131e-03f, +2.15627141e-02f, -1.92558751e-01f, +8.25299472e-02f, -1.28610045e-01f, +3.08415536e-02f, -2.75440931e-01f, +1.82784572e-01f, +4.44822125e-02f, +1.36352792e-01f, -2.28484243e-01f, -1.41144425e-01f, -1.81406066e-01f, +6.88254759e-02f, +1.70062765e-01f, -1.98728904e-01f, -1.00889593e-01f, -2.14617938e-01f, -2.17317268e-01f, -4.83794957e-02f, +1.10659704e-01f, +8.47618729e-02f, -1.91582188e-01f, +1.00471340e-01f, -2.81668097e-01f, -2.19853967e-01f, +2.36480892e-01f, +2.22440243e-01f, +2.10569382e-01f, -2.84347445e-01f, -2.19591379e-01f, -2.45121956e-01f, +1.04809031e-01f, +1.73815280e-01f, +7.35516995e-02f, +5.26914261e-02f, +1.04123309e-01f, +2.79176626e-02f, +2.99485680e-03f, -1.26199812e-01f, -9.86231267e-02f, -2.41935268e-01f, +1.54229239e-01f, +7.91810155e-02f, -5.81651963e-02f, -5.91709986e-02f, -1.32547453e-01f, -1.38862893e-01f, -3.21929246e-01f, +9.20422748e-02f, +1.77596286e-01f, +1.81038484e-01f, +7.70760402e-02f, +1.55476674e-01f, -2.03008935e-01f, -2.84547098e-02f, -5.64792678e-02f, +5.50335855e-04f, -2.05144450e-01f, -2.15384066e-01f, +7.92259409e-04f, -1.33851871e-01f, +5.74411452e-03f, -2.96832204e-01f, -3.31932604e-02f, +1.34259850e-01f, +4.13397513e-02f, +7.99804181e-02f, -3.36530566e-01f, +7.67248869e-02f, +8.25507753e-03f, -8.72239769e-02f, -6.00250326e-02f, -7.03311041e-02f, +6.03106357e-02f, +3.13605033e-02f, -3.05638969e-01f, +1.64388701e-01f, +7.01560006e-02f, -1.50078326e-01f, +1.28360754e-02f, -8.57958198e-02f, -1.26445234e-01f, +5.95089942e-02f, +2.15322673e-01f, -1.32144809e-01f, -2.83690766e-02f, +6.13031350e-02f, +2.53681391e-01f, +2.44709224e-01f, -1.69493258e-01f, +1.37431785e-01f, +7.77824745e-02f, -1.17464840e-01f, -7.25399107e-02f, -2.23816007e-01f, +1.88227549e-01f, +1.79120302e-01f, +6.91722333e-02f, -4.39284295e-02f, +1.37915507e-01f, -1.74204215e-01f, -2.25137576e-01f, +2.77007651e-02f, +3.52528878e-02f, -2.71724075e-01f, -1.29288703e-01f, -1.33166641e-01f, +1.05071768e-01f, -1.75012946e-01f, -8.22768733e-02f, -2.43865833e-01f, -2.75879741e-01f, -9.04454961e-02f, -7.01478347e-02f, +8.36820677e-02f, -1.01591386e-01f, -2.56523997e-01f, +1.45567775e-01f, +2.24587813e-01f, -2.50689834e-01f, -3.04108784e-02f, -2.22750470e-01f, +1.49985954e-01f, +1.61489159e-01f, -1.40216306e-01f, +2.07441270e-01f, +9.02169198e-02f, -2.79697701e-02f, -5.97373545e-02f, -1.15680590e-01f, +1.71077073e-01f, -1.81569189e-01f, +1.87281623e-01f, +2.24139512e-01f, -1.41838640e-01f, -8.89796671e-03f, +1.06792204e-01f, -1.69748947e-01f, -3.06304693e-01f, -3.32654603e-02f, +7.44931325e-02f, +9.31678265e-02f, -1.23218425e-01f, +7.50313560e-03f, -1.55480966e-01f, -1.81727350e-01f, -5.84172271e-02f, -5.58801694e-03f, -1.86638311e-01f, +5.60953617e-02f, +1.51304707e-01f, +9.46034640e-02f, -2.02119976e-01f, +2.20171988e-01f, +1.54010072e-01f, +1.03351325e-01f, +2.14425206e-01f, -1.00316569e-01f, -2.42199242e-01f, +5.45421652e-02f, -1.05365448e-01f, +4.49590534e-02f, -2.78317720e-01f, -6.48851320e-02f, -4.02741581e-02f, -6.77505359e-02f, -1.02309570e-01f, -2.20530435e-01f, +1.92687228e-01f, -1.21909596e-01f, -1.89052671e-01f, +1.06069997e-01f, -1.49239689e-01f, -2.04116926e-01f, -1.53533712e-01f, +1.19257309e-01f, +1.05441073e-02f, -4.51602079e-02f, -4.79360148e-02f, -3.73576805e-02f, -1.84946597e-01f, +1.13855803e-03f, -2.65902936e-01f, -2.53806449e-02f, -8.01955909e-02f, -1.07164785e-01f, -2.85324037e-01f, -1.77902788e-01f, -5.59527567e-03f, -7.11230421e-03f, +2.78086007e-01f, +2.41036370e-01f, +2.35028520e-01f, +2.93850526e-02f, -1.72343664e-02f, +7.54900649e-02f, +2.18979269e-01f, -7.54408091e-02f, -1.49316505e-01f, -5.25269844e-02f, +1.77138239e-01f, +6.16204068e-02f, -2.85701364e-01f, +1.57719105e-01f, -2.39797756e-01f, +1.36644676e-01f, -2.63982385e-01f, +1.93989381e-01f, -3.27985108e-01f, -1.78348094e-01f, +1.66341648e-01f, -3.19908410e-01f, -1.06539816e-01f, -4.65437062e-02f, -1.15125693e-01f, -4.42163181e-03f, -2.33589068e-01f, +1.57862961e-01f, -1.14429951e-01f, +2.73347758e-02f, -2.11517438e-01f, -1.89593863e-02f, -1.71284780e-01f, -1.12018272e-01f, -2.63119459e-01f, -2.21589789e-01f, -3.33005697e-01f, +1.13230599e-02f, +1.36840314e-01f, -4.66181338e-02f, -2.14272827e-01f, -2.29004756e-01f, +3.39514948e-02f, -1.57026555e-02f, +1.58025727e-01f, +2.40212195e-02f, +1.70401912e-02f, +4.81900312e-02f, -3.84137519e-02f, -3.33024748e-02f, +1.48911178e-01f, -2.32561171e-01f, +2.47685127e-02f, -1.21043205e-01f, -2.03966469e-01f, -1.35590807e-01f, +1.25244558e-01f, +2.02813260e-02f, -2.63504326e-01f, +9.72979218e-02f, -9.05295461e-02f, +8.52397084e-03f, -1.63176045e-01f, -1.37528712e-02f, -5.24494462e-02f, +1.91256583e-01f, +2.15781391e-01f, +1.65874287e-01f, +2.33785674e-01f, -1.71831354e-01f, -1.22838803e-02f, +1.66304767e-01f, -1.16785541e-01f, -1.31602526e-01f, -1.42010778e-01f, +1.40625730e-01f, -1.31235346e-01f, -2.36984625e-01f, -2.98324347e-01f, -2.14824434e-02f, -2.40142971e-01f, +3.47518781e-03f, +4.42368817e-03f, -2.89660823e-02f, -3.26792508e-01f, -3.37357789e-01f, -2.41304681e-01f, +8.48633870e-02f, -3.08670640e-01f, +1.18652962e-01f, -3.04782450e-01f, +6.42089471e-02f, -3.49187076e-01f, -4.17348415e-01f, +7.01309368e-02f, +6.14970028e-02f, -3.43598276e-01f, -4.13424283e-01f, +1.39116451e-01f, -1.99054554e-02f, -3.17608178e-01f, -1.11896515e-01f, +8.34187046e-02f, +9.24443603e-02f, -1.08364753e-01f, -2.83895396e-02f, +3.28339338e-01f, +3.39996517e-01f, +3.35311890e-02f, -1.02317333e-01f, +9.45185348e-02f, -2.82634407e-01f, -3.06511223e-01f, -1.73013210e-02f, +3.24107707e-02f, -6.09042123e-02f, +2.76456121e-02f, -2.34314110e-02f, +1.84048593e-01f, -3.03271383e-01f, +2.31603846e-01f, -2.57506175e-03f, -1.52978629e-01f, -2.61006504e-01f, -9.89368930e-02f, -2.79516816e-01f, -3.17945212e-01f, -3.17523569e-01f, -2.50667453e-01f, -2.45086968e-01f, -3.76627035e-02f, +4.79859784e-02f, -1.61700577e-01f, +1.92262251e-02f, -3.05729449e-01f, -3.83015364e-01f, -4.60960656e-01f, -3.50415498e-01f, -2.97477037e-01f, -2.40011156e-01f, +6.73854947e-02f, +7.49646053e-02f, -2.76597217e-02f, -2.04794466e-01f, -1.33228265e-02f, -2.52678543e-01f, +2.37664767e-03f, +6.62613064e-02f, +7.20213875e-02f, -2.22532257e-01f, +1.45860855e-02f, +1.56121314e-01f, -2.53009379e-01f, +2.57091969e-01f, -6.79412037e-02f, -6.22112490e-02f, -1.58747137e-02f, -2.95742065e-01f, +3.88428941e-02f, -3.21356803e-01f, -1.52244285e-01f, +2.50339713e-02f, -1.90478146e-01f, +3.68995368e-02f, -1.76169947e-02f, +1.08461082e-01f, +1.00407213e-01f, -1.27368823e-01f, +2.11211324e-01f, +1.89505637e-01f, +1.59784760e-02f, -5.34313694e-02f, -1.01537116e-01f, -2.57509470e-01f, -7.18332604e-02f, +1.91112608e-01f, +1.24389090e-01f, +1.88551337e-01f, +1.61326658e-02f, -5.41880429e-02f, +7.73185343e-02f, +1.80374812e-02f, -4.35197586e-03f, -3.44309151e-01f, +1.25077948e-01f, -3.40265125e-01f, -4.92967427e-01f, -4.25119281e-01f, -1.15548491e-01f, -1.78460360e-01f, -2.10521758e-01f, -3.07329625e-01f, -5.00235427e-03f, -2.51257658e-01f, -2.17008874e-01f, -1.20431431e-01f, -2.57409662e-01f, -9.60736945e-02f, +5.67653636e-03f, -4.04859930e-01f, -1.72163114e-01f, -4.11083490e-01f, -3.26501548e-01f, -1.55158430e-01f, -4.89484489e-01f, -3.49275805e-02f, +4.20247428e-02f, -5.37555404e-02f, -2.51288384e-01f, -2.66752124e-01f, +1.24315783e-01f, -2.60420263e-01f, -4.11900990e-02f, +1.47784472e-01f, +8.45915601e-02f, -1.99735969e-01f, -7.46610090e-02f, -2.13182390e-01f, +5.57892770e-02f, +1.79571807e-01f, +1.08238533e-01f, +1.88812092e-01f, -2.86244512e-01f, -1.13077410e-01f, -3.40556711e-01f, -2.56668955e-01f, -3.29167157e-01f, -3.25171232e-01f, -3.37245017e-02f, -8.07097740e-03f, -7.89495334e-02f, +6.86187968e-02f, +4.81232442e-02f, +3.70489955e-01f, +4.34768438e-01f, +1.30348861e-01f, +2.63432264e-02f, +2.11447522e-01f, -2.88403064e-01f, +8.98158029e-02f, +2.30916858e-01f, +9.85980630e-02f, -2.20425755e-01f, -2.60392912e-02f, -2.55745173e-01f, -1.25903949e-01f, -1.32943183e-01f, -5.28568439e-02f, +1.90248996e-01f, -1.32379785e-01f, +2.38521248e-01f, -9.27378908e-02f, +1.41041934e-01f, -1.28208905e-01f, -1.37578219e-01f, -2.71850109e-01f, -2.37314001e-01f, +5.78178577e-02f, -1.29388407e-01f, -1.23596355e-01f, -2.10462362e-01f, -1.73220024e-01f, +1.46554291e-01f, -1.41170740e-01f, -1.59019530e-01f, -2.53199369e-01f, -2.08820209e-01f, +8.28233510e-02f, -2.54301131e-01f, +1.38491318e-02f, -1.72867790e-01f, -2.18839124e-01f, -1.76008344e-01f, +2.41854012e-01f, +6.03309050e-02f, +2.75313351e-02f, -1.27674580e-01f, -8.00097585e-02f, +1.30277380e-01f, -1.82773933e-01f, +1.86596066e-01f, -4.90327887e-02f, -2.72076931e-02f, -2.84810781e-01f, -2.13378787e-01f, +1.19895674e-01f, -5.96700870e-02f, +9.98293236e-02f, -8.19387585e-02f, -1.63658500e-01f, -2.78410614e-01f, -2.25470856e-01f, -3.53904545e-01f, +5.93868792e-02f, +1.36913806e-01f, +1.32854983e-01f, +1.70514435e-01f, -1.87069833e-01f, +1.92635402e-01f, +2.93217245e-02f, -4.89212349e-02f, +1.25820637e-02f, -3.55294555e-01f, -3.61215860e-01f, -3.20864856e-01f, -3.83354247e-01f, +1.22420035e-01f, +1.50233442e-02f, +1.10410184e-01f, -1.71797141e-01f, -3.05980057e-01f, -3.29311788e-01f, -1.64978281e-01f, -2.19259351e-01f, -3.50478441e-01f, -3.40784907e-01f, -6.15346991e-02f, -1.78324178e-01f, +1.23825990e-01f, -2.26461381e-01f, +1.76735952e-01f, -2.56101042e-01f, +6.24869838e-02f, +1.99045852e-01f, +1.10636652e-01f, -1.45826921e-01f, -1.23189881e-01f, +1.65735558e-01f, -7.49704093e-02f, -3.35132778e-01f, -1.24121703e-01f, -3.20231766e-02f, -3.90407890e-02f, -8.33311155e-02f, -1.23600282e-01f, -2.41517156e-01f, -1.99356869e-01f, -2.59411521e-02f, -3.01682986e-02f, -3.11990790e-02f, +5.97921386e-02f, -2.78800696e-01f, +1.79710120e-01f, -2.73798823e-01f, +1.14712015e-01f, +2.08068490e-01f, +2.27088794e-01f, -2.04598397e-01f, -4.26238216e-02f, -2.22349286e-01f, +8.00633430e-02f, -2.80547291e-01f, -1.84247166e-01f, +1.99108273e-01f, -2.72856265e-01f, -1.21740140e-01f, -1.05078176e-01f, +2.26791546e-01f, +1.04807384e-01f, -2.35187486e-01f, +1.68313995e-01f, -2.74028003e-01f, +1.76519826e-01f, -8.38725418e-02f, -7.09539503e-02f, -7.63155818e-02f, -2.10403930e-02f, +1.44150957e-01f, +1.68605775e-01f, +2.83885896e-02f, -2.81915404e-02f, +5.93096911e-06f, +1.79731280e-01f, -6.49787893e-04f, +1.80408582e-01f, +8.11388344e-02f, -9.14648026e-02f, +1.24701872e-01f, -2.25320354e-01f, +5.53549975e-02f, -8.50114599e-02f, -1.38957843e-01f, +4.96960022e-02f, +5.28031075e-03f, -2.96819866e-01f, +1.52747244e-01f, -1.99028969e-01f, -1.57283485e-01f, +1.41367227e-01f, -2.42091060e-01f, -2.13688359e-01f, -3.28972071e-01f, -9.06398147e-02f, +1.44132093e-01f, -8.75686929e-02f, +6.20285654e-03f, -2.68961519e-01f, +5.01876213e-02f, +3.44075263e-02f, -7.32134283e-02f, -8.73156711e-02f, -1.75633714e-01f, -1.21566981e-01f, -2.79200077e-01f, +2.14882970e-01f, +6.31627813e-02f, +1.85741782e-01f, -6.30772263e-02f, +1.89630821e-01f, +1.59149662e-01f, +4.24949750e-02f, -1.85196668e-01f, -2.18552023e-01f, -1.13922499e-01f, -3.15216422e-01f, -2.92263180e-01f, +7.18488842e-02f, +1.77619338e-01f, -1.28348097e-01f, +1.30278647e-01f, +8.31212625e-02f, -1.30563959e-01f, -1.18314169e-01f, -1.87802762e-01f, +1.34534650e-02f, +2.39457354e-01f, +1.19331941e-01f, -1.00527875e-01f, +1.24004371e-01f, -2.70113498e-01f, +2.22277835e-01f, -1.16724677e-01f, +2.55527198e-01f, -6.68700635e-02f, -1.55053988e-01f, -2.12318927e-01f, -9.59319323e-02f, -2.36149058e-01f, +2.48476774e-01f, -1.31417781e-01f, -1.43486217e-01f, +9.56070200e-02f, -7.96107575e-02f, -1.15101352e-01f, -1.55660421e-01f, +2.15196982e-02f, -1.35634407e-01f, -1.66258559e-01f, -9.08249021e-02f, +1.81728676e-01f, +4.30026688e-02f, -1.33663759e-01f, -1.98847754e-03f, -1.92254275e-01f, -7.76764601e-02f, +2.98841652e-02f, -2.93272771e-02f, +2.27436841e-01f, +2.31815174e-01f, -1.22801356e-01f, +5.79519104e-03f, +4.52611782e-02f, -1.07964024e-01f, +1.26209781e-01f, +3.82091440e-02f, +7.47950897e-02f, -2.61307210e-01f, -1.18202336e-01f, +7.83981681e-02f, -1.36330485e-01f, +1.13842227e-01f, -2.68516868e-01f, +2.89298948e-02f, -1.30453914e-01f, +1.54973045e-01f, +1.94823906e-01f, +4.50482313e-03f, -1.67881534e-01f, -2.67705590e-01f, +1.09150872e-01f, +2.95168936e-01f, +2.68754542e-01f, +1.49789929e-01f, -2.59091407e-01f, -3.75688486e-02f, -1.32544211e-03f, -1.54634550e-01f, -1.26198456e-01f, -1.44453973e-01f, -1.33365586e-01f, -1.65984873e-02f, +1.99735716e-01f, +2.33623773e-01f, -1.45892918e-01f, +1.95930764e-01f, -3.20155770e-01f, +6.99366778e-02f, +1.22439869e-01f, +6.12619147e-02f, +1.39350072e-01f, +1.01838619e-01f, +1.96692534e-02f, -1.44928887e-01f, +5.84948584e-02f, +1.78923551e-02f, -8.95499289e-02f, +1.74510106e-01f, +1.30370140e-01f, -1.32708967e-01f, +1.22157328e-01f, -2.59708136e-01f, +1.20043643e-01f, -1.94479853e-01f, -1.10449560e-01f, +1.17159896e-01f, +2.70241827e-01f, +2.67697394e-01f, -1.09525092e-01f, +3.64739336e-02f, +3.74368340e-01f, +1.25121176e-01f, +1.26177073e-02f, -1.03794217e+00f, +5.06113805e-02f, +8.91368762e-02f, +1.26557469e-01f, +1.86881676e-01f, +9.90018398e-02f, +6.81779012e-02f, +1.39394283e-01f, -2.35634208e-01f, -1.68321341e-01f, -6.78578839e-02f, -1.90509617e-01f, -4.41292388e-04f, +2.40242019e-01f, +1.06892139e-01f, +2.13265911e-01f, +5.98653853e-02f, -2.52968431e-01f, -1.38754621e-01f, +5.96790053e-02f, -9.91738737e-02f, +1.93754345e-01f, +2.19729915e-01f, -1.43191934e-01f, +1.15543738e-01f, -1.87476024e-01f, +3.90676502e-03f, -1.55690894e-01f, +2.38193855e-01f, -2.51086235e-01f, -1.91233799e-01f, -2.51898736e-01f, -2.60094076e-01f, -2.90222317e-01f, -2.55380034e-01f, -2.56580114e-01f, +6.13896176e-02f, -3.90531346e-02f, -2.46746436e-01f, +4.97807749e-02f, +1.69124246e-01f, -1.44409373e-01f, -6.06105253e-02f, -1.88518450e-01f, -2.60572642e-01f, -1.47232994e-01f, -1.06194345e-02f, -2.63053745e-01f, -1.86069712e-01f, +9.81700197e-02f, +1.65953547e-01f, -3.41814160e-02f, +1.07425988e-01f, +5.25173545e-02f, -1.92116741e-02f, -1.79335952e-01f, +1.71268016e-01f, +8.09919909e-02f, -1.60899028e-01f, +4.66529503e-02f, -3.88395898e-02f, -1.94271356e-01f, -1.48938566e-01f, -7.46387914e-02f, +7.89723545e-02f, +2.41864771e-01f, -1.91621393e-01f, +4.90944311e-02f, +5.27203158e-02f, +1.54971108e-01f, -2.68056035e-01f, +1.13086678e-01f, +1.74713880e-01f, +6.07043155e-04f, +2.63838112e-01f, +1.76760480e-01f, +2.39258796e-01f, -8.65425989e-02f, -1.79004166e-02f, -1.93077177e-01f, -2.18516797e-01f, +1.32234752e-01f, +2.27084190e-01f, +2.52682149e-01f, -1.61346614e-01f, -7.36307800e-02f, +6.31357059e-02f, +1.06120348e-01f, +1.75839104e-02f, -1.50038168e-01f, +1.17627911e-01f, +3.21748316e-01f, +2.88751751e-01f, +1.55988457e-02f, +2.38669112e-01f, -2.16169760e-01f, -1.30684137e+00f, -1.10066563e-01f, -1.24814764e-01f, -2.25183189e-01f, +3.88145149e-02f, +6.04921877e-02f, -2.17644855e-01f, -1.14640251e-01f, +2.27469981e-01f, +2.00657487e-01f, +9.97197330e-02f, +1.69346780e-01f, -2.51304030e-01f, -1.29848644e-01f, +2.11584508e-01f, +1.06314391e-01f, -1.95869684e-01f, -2.88804770e-02f, -1.80028871e-01f, -9.85672474e-02f, +2.36580670e-01f, +3.85305583e-02f, -2.17822582e-01f, -2.64361501e-03f, +9.22116935e-02f, -2.08485201e-01f, -1.40783161e-01f, +1.76282585e-01f, +2.29682148e-01f, -1.38110757e-01f, -1.11077771e-01f, +2.26056188e-01f, -9.05337185e-02f, -1.35381550e-01f, -1.42764449e-02f, +5.67069650e-03f, +7.50542283e-02f, -3.89418304e-02f, +1.28256917e-01f, -3.85879427e-02f, -1.13872007e-01f, -1.73731625e-01f, -5.45654893e-02f, -1.37423873e-01f, +1.17835850e-01f, -1.66812077e-01f, -1.11463457e-01f, +2.61146486e-01f, -1.94582760e-01f, +2.08596796e-01f, -1.49985328e-01f, +2.33464420e-01f, +1.10545464e-01f, +2.07763627e-01f, -1.83782056e-01f, +2.33287290e-01f, -2.43789867e-01f, +8.97436589e-02f, -2.33381107e-01f, +2.01434195e-02f, +5.08564664e-03f, -1.77399307e-01f, +4.85423878e-02f, -1.04864210e-01f, +1.97833493e-01f, -1.89391568e-01f, -1.51066154e-01f, -1.00491017e-01f, -2.06491292e-01f, -2.41046622e-01f, -1.19440190e-01f, +1.54344896e-02f, -1.64906800e-01f, +1.41754508e-01f, -2.04556540e-01f, -1.32673159e-01f, -1.38373524e-01f, -2.01799661e-01f, -6.87420592e-02f, -9.25517529e-02f, +1.19997330e-01f, +2.27867335e-01f, +1.11877009e-01f, -6.92220181e-02f, -1.49876580e-01f, -2.70179629e-01f, +5.23024239e-03f, +1.72631666e-01f, +1.03476472e-01f, -5.12989536e-02f, -4.37336788e-02f, +9.82375443e-02f, -2.82362550e-01f, +1.64495334e-01f, +2.18508691e-02f, -9.85046569e-03f, +5.73948957e-02f, -2.28046328e-01f, +2.23635346e-01f, +2.23952800e-01f, -2.21031904e-02f, -2.49710023e-01f, -2.05766380e-01f, -8.69522989e-02f, -1.64530843e-01f, +1.56955749e-01f, -1.72620863e-01f, +1.88399583e-01f, -9.04684216e-02f, +2.30820239e-01f, -2.39461347e-01f, +2.63797343e-02f, +1.99549198e-02f, -5.97681403e-02f, +6.48404062e-02f, -1.17586240e-01f, -2.54700631e-02f, +1.84454799e-01f, -2.09068671e-01f, +1.37620568e-02f, +1.25785351e-01f, +1.15118623e-02f, -1.03584930e-01f, -2.27628767e-01f, +9.57497060e-02f, -2.64683604e-01f, -2.17030376e-01f, +1.19850934e-02f, +5.82103133e-02f, +1.45836234e-01f, -2.45725617e-01f, -1.61919236e-01f, -1.23934925e-01f, -1.68607712e-01f, -1.00272983e-01f, -1.57049894e-01f, +1.89565390e-01f, -1.79632664e-01f, -2.60960370e-01f, +1.68987006e-01f, -1.36311650e-02f, -1.57918811e-01f, +1.11920536e-02f, -2.67585397e-01f, +1.03491426e-01f, -2.96879977e-01f, +1.28177851e-01f, +1.70409784e-01f, -3.74736451e-02f, -3.33385449e-03f, +1.86867192e-01f, +2.73371786e-01f, +1.46280751e-01f, -1.16898008e-01f, -1.83267817e-01f, +9.99953300e-02f, -1.96710736e-01f, +2.24575177e-01f, +2.01302737e-01f, +2.20790774e-01f, +2.25064307e-01f, +2.15367042e-03f, +7.02175274e-02f, -3.74713577e-02f, -1.38635024e-01f, -2.94050276e-01f, -1.36118710e-01f, +1.07398875e-01f, -3.16679716e-01f, -3.01806688e-01f, -3.63216341e-01f, +1.24774650e-01f, +5.63983880e-02f, -9.08757001e-02f, -4.49956469e-02f, -3.73220682e-01f, +6.95324168e-02f, -2.79901177e-01f, -2.06135198e-01f, -1.77861854e-01f, +6.82057217e-02f, +8.10789615e-02f, +8.26826468e-02f, -3.77355404e-02f, +1.68243140e-01f, -1.25384927e-01f, -3.17621201e-01f, -1.59751456e-02f, -1.23897776e-01f, -8.78704060e-03f, +1.61433876e-01f, -1.73173070e-01f, +1.62173852e-01f, -6.72558397e-02f, -1.55101568e-01f, -2.75950283e-02f, +2.26899832e-01f, +1.87475964e-01f, -1.87275812e-01f, -1.85618937e-01f, -2.31108963e-01f, -3.48443091e-02f, +1.19932652e-01f, -2.75136948e-01f, +1.79828346e-01f, -2.64385849e-01f, -2.97154427e-01f, -1.17345050e-01f, -1.60627618e-01f, -2.57460177e-02f, -2.21068889e-01f, +7.32472092e-02f, -4.27211225e-02f, +1.87242731e-01f, +1.46504790e-01f, -1.55550344e-02f, +1.91553205e-01f, -5.38970716e-02f, -6.78268969e-02f, +2.48541042e-01f, +1.43325388e-01f, -2.49586329e-01f, -2.70879656e-01f, -1.75154120e-01f, +2.05657095e-01f, +2.60940880e-01f, -1.64006725e-01f, +1.71643384e-02f, -2.86514610e-01f, -1.81364760e-01f, +8.75837877e-02f, +1.46884561e-01f, -9.47584361e-02f, -2.01186985e-01f, -2.22050890e-01f, -7.41934255e-02f, -2.79714167e-01f, -2.90273607e-01f, +1.11753188e-01f, +5.85245639e-02f, -1.90961450e-01f, -1.70467719e-01f, -1.58875823e-01f, -2.98993140e-01f, -2.38825664e-01f, +2.65123299e-03f, -5.58226295e-02f, -2.59900928e-01f, +6.16608895e-02f, -3.17223758e-01f, +1.25350103e-01f, +8.93391389e-03f, -6.99794441e-02f, -6.38326481e-02f, -4.15257007e-01f, -3.68454099e-01f, -2.67237276e-01f, +7.33035952e-02f, -2.50630856e-01f, +9.94196534e-02f, +4.72475775e-02f, -1.65155306e-01f, +1.35303259e-01f, -1.97019964e-01f, -4.80523072e-02f, +9.72910896e-02f, -2.52057493e-01f, +5.76127954e-02f, -2.80783683e-01f, -2.14845434e-01f, -4.78090793e-02f, -2.32242510e-01f, +1.00151390e-01f, +8.83102044e-02f, +3.66390534e-02f, +8.98958445e-02f, +1.99813977e-01f, -2.90917426e-01f, +1.28979990e-02f, -8.98517743e-02f, -3.00584197e-01f, -2.53427122e-02f, +4.74209301e-02f, -1.98574081e-01f, +6.15987321e-03f, +1.10367842e-01f, -8.50482658e-02f, +2.39241004e-01f, +3.58587116e-01f, -2.36326575e-01f, -1.74352989e-01f, +1.60089269e-01f, +1.64746195e-01f, +6.21777773e-03f, +1.15322672e-01f, -2.53955033e-02f, +1.97703183e-01f, -1.77681282e-01f, +1.42742515e-01f, +7.25757629e-02f, +2.15803176e-01f, -1.31062433e-01f, +1.11504510e-01f, +2.20140263e-01f, +1.41396344e-01f, -1.74951538e-01f, -2.39956275e-01f, -1.44780129e-01f, -2.54242867e-01f, -2.81132847e-01f, -1.31418973e-01f, -1.48951471e-01f, -7.01682642e-02f, -3.21089000e-01f, -2.51261145e-01f, -3.14646959e-01f, +1.03557803e-01f, -1.28297031e-01f, -4.50552627e-02f, -2.96131849e-01f, +1.78566203e-01f, -2.21699566e-01f, -1.21257685e-01f, +1.17998555e-01f, -8.56207088e-02f, +2.20164552e-01f, -2.89544195e-01f, +2.55573601e-01f, +4.91711646e-02f, +1.95236597e-02f, -2.47086391e-01f, -4.96442616e-02f, -2.77107477e-01f, -2.25160331e-01f, -7.58780614e-02f, +1.78758383e-01f, -5.50824478e-02f, +2.03645900e-01f, -1.98083624e-01f, +2.11775437e-01f, +1.54717982e-01f, +8.40864033e-02f, -9.04246271e-02f, +2.43814781e-01f, -2.26857916e-01f, +2.71025356e-02f, -5.75072356e-02f, -1.35061711e-01f, -8.77184514e-03f, +2.30589956e-01f, -9.78968069e-02f, -8.90742913e-02f, -1.01458039e-02f, +3.85467671e-02f, -9.37195569e-02f, +1.54984249e-02f, +5.65698817e-02f, +1.56714976e-01f, +2.43169829e-01f, -1.38731524e-01f, +2.47053221e-01f, +2.20568821e-01f, +1.40077531e-01f, -2.43552439e-02f, +6.97094724e-02f, -6.60989806e-03f, -2.91359425e-01f, -1.02341110e-02f, -1.13711327e-01f, +6.43845424e-02f, +9.59515292e-03f, -1.48127511e-01f, +2.59125948e-01f, -1.87932909e-01f, +2.12331906e-01f, -1.49306908e-01f, +2.72854596e-01f, -1.31193548e-01f, -5.80906905e-02f, -1.11305714e-01f, -1.70414373e-01f, -2.12387040e-01f, +8.06741714e-02f, +4.21250671e-01f, +1.36389959e+00f, -1.44881338e-01f, +9.05338079e-02f, -3.67226899e-01f, +4.13745642e-03f, -2.61205256e-01f, -2.38139719e-01f, +3.81626375e-02f, -2.57211655e-01f, -2.17036247e-01f, -1.89656466e-02f, +6.06859624e-02f, -1.14874803e-01f, -4.32753950e-01f, -3.26459408e-01f, +3.85439880e-02f, -3.44992489e-01f, -4.04044986e-02f, +2.00504810e-02f, -4.82828766e-02f, -1.88384339e-01f, -2.13948041e-01f, -6.04437571e-03f, -5.33219650e-02f, -1.50223881e-01f, -4.65736426e-02f, +1.17799528e-01f, -1.59704596e-01f, -1.27748284e-03f, +1.27175346e-01f, +7.10788965e-02f, -1.61009252e-01f, +1.59252107e-01f, -2.05977801e-02f, +6.45530075e-02f, +3.28682028e-02f, -2.51150846e-01f, +1.74681604e-01f, -5.80603220e-02f, -1.65954158e-01f, -1.85038820e-01f, -4.09016013e-01f, -1.74864411e-01f, -1.83424503e-01f, -3.75932932e-01f, -4.40151513e-01f, -4.36885089e-01f, -3.08300942e-01f, -4.43738461e-01f, +2.49891877e-01f, +1.47909056e-02f, -7.07699135e-02f, +1.92263663e-01f, +1.78336993e-01f, -2.80079275e-01f, -1.21308617e-01f, -1.71197709e-02f, +1.19113885e-01f, -7.00949728e-02f, -1.05770148e-01f, -2.87953258e-01f, -2.72056103e-01f, -1.46917820e-01f, +3.71051468e-02f, -2.07760707e-01f, -2.40388483e-01f, -6.63953945e-02f, +1.93188936e-01f, -2.43125707e-01f, -9.80390310e-02f, -1.11451797e-01f, -2.05529496e-01f, -3.61321382e-02f, -2.65383422e-01f, +4.31037657e-02f, -1.00765787e-01f, +2.84858178e-02f, +1.02970593e-01f, +3.65474559e-02f, +1.28345758e-01f, +2.01899827e-01f, +1.26334310e-01f, -1.04602657e-01f, -1.97099879e-01f, -1.95537075e-01f, +7.87310973e-02f, -6.32927865e-02f, -2.96789467e-01f, +1.41782254e-01f, -2.80662119e-01f, -8.71102735e-02f, -2.15552837e-01f, -2.58107390e-02f, -1.74507529e-01f, -4.24850993e-02f, +2.13660687e-01f, -3.14753428e-02f, -3.23048443e-01f, -1.48943588e-01f, -1.03360415e-01f, +1.59103811e-01f, +7.98583925e-02f, -1.35283679e-01f, -8.54852498e-02f, -2.32821614e-01f, +1.41050518e-01f, +1.34256229e-01f, -8.55035856e-02f, +1.17321037e-01f, -2.07513511e-01f, -2.58483440e-01f, -2.01972157e-01f, -3.57038341e-02f, -1.33065224e-01f, -1.02265827e-01f, +1.12003185e-01f, -1.18417792e-01f, -2.59091139e-01f, -9.59429666e-02f, -2.71374077e-01f, -1.77499220e-01f, +8.84651020e-02f, -2.92970657e-01f, -1.96875781e-01f, -1.78358760e-02f, -3.21393251e-01f, +1.21016487e-01f, +5.11631742e-02f, -5.63260503e-02f, +8.44634324e-02f, +1.77650556e-01f, +3.34917642e-02f, -1.85389325e-01f, +1.52845919e-01f, -1.80601284e-01f, -9.46881250e-02f, -6.29781559e-02f, -1.16373621e-01f, +4.13407423e-02f, -1.91469654e-01f, -3.80562305e-01f, +4.23982292e-02f, -6.82745352e-02f, +4.14205454e-02f, -3.14342231e-01f };

static const float B_dense_4[32] = { -2.19995696e-02f, -3.82701047e-02f, -3.41743492e-02f, +1.29234474e-02f, -3.25342268e-02f, -7.88602754e-02f, -2.77026221e-02f, +5.96694741e-03f, -1.85105335e-02f, -1.94767248e-02f, +1.09021127e-01f, +3.36977206e-02f, +1.05580457e-01f, -1.66578628e-02f, +6.73750555e-03f, -4.86906618e-02f, -3.68730128e-02f, -1.86489634e-02f, +7.32219964e-02f, -2.81041209e-02f, +1.61647379e-01f, +0.00000000e+00f, -3.94701846e-02f, +0.00000000e+00f, -1.07924178e-01f, +4.32421826e-03f, +6.89126477e-02f, -4.59935553e-02f, -7.06480816e-03f, +5.37734292e-02f, -2.58052871e-02f, -3.39137018e-02f };

// layer dense_5: kernel (16 x 32), bias (16)
static const float W_dense_5[512] = { +1.45745769e-01f, -4.48842913e-01f, +1.01829223e-01f, +1.69079468e-01f, -3.45332056e-01f, +5.81595302e-02f, -2.88813114e-01f, -2.54350543e-01f, +6.53019315e-03f, -2.27978155e-01f, -7.18937665e-02f, -3.20449144e-01f, -1.90585449e-01f, -2.80618608e-01f, -1.58738159e-03f, +1.83240429e-01f, -2.62869358e-01f, -2.66445369e-01f, -2.98466593e-01f, +3.04895371e-01f, -3.61326724e-01f, -1.96859911e-01f, -8.79084878e-03f, +1.41757548e-01f, +5.45204692e-02f, -1.99470714e-01f, -1.48677871e-01f, -1.52769819e-01f, +1.25343993e-01f, +2.91435808e-01f, +3.49855751e-01f, +8.69175345e-02f, -1.54162019e-01f, -2.19373003e-01f, +1.41615355e-02f, -1.53507749e-02f, +2.46513307e-01f, +3.41041863e-01f, +2.70214021e-01f, +3.01042534e-02f, +2.84907788e-01f, +1.98464036e-01f, +2.65127420e-01f, -9.89892855e-02f, +1.53739795e-01f, -3.55041951e-01f, +2.16973707e-01f, -8.06379020e-02f, -1.60251617e-01f, +1.00011505e-01f, +4.97082412e-01f, +2.94541150e-01f, +4.72353846e-02f, -2.69006819e-01f, +2.21436456e-01f, +1.57665104e-01f, +3.20938587e-01f, +7.11011291e-01f, +3.34671065e-02f, -2.03081638e-01f, -6.67839274e-02f, +3.24148417e-01f, -9.02006030e-02f, +1.79943681e-01f, +7.12024570e-02f, +1.26889959e-01f, -2.31468622e-02f, -2.53314376e-01f, +2.98889846e-01f, -6.10905327e-02f, -2.82898605e-01f, -1.50665238e-01f, +3.48891281e-02f, -3.11606172e-02f, +4.50474173e-02f, -1.28688186e-01f, -2.26190746e-01f, -3.60365808e-02f, +2.31514305e-01f, +1.42561704e-01f, +2.53601581e-01f, -1.75087363e-01f, +2.70680726e-01f, -2.55634874e-01f, -1.12198301e-01f, +2.02714175e-01f, +6.92680851e-03f, -3.11840743e-01f, -4.47855927e-02f, +1.31286770e-01f, +6.30764812e-02f, +3.24478418e-01f, -3.29574108e-01f, -2.02461496e-01f, -1.20533161e-01f, +5.19783758e-02f, -2.86488205e-01f, +2.48649400e-02f, +2.64716089e-01f, +5.10137901e-02f, -5.52621074e-02f, +5.53355105e-02f, +2.73200542e-01f, -3.37925017e-01f, -9.91810039e-02f, -1.97901025e-01f, -3.19852799e-01f, +1.14892110e-01f, -4.74287748e-01f, +1.27743155e-01f, +5.77292442e-02f, -1.03022166e-01f, +3.23330224e-01f, -1.80180639e-01f, +1.59511790e-01f, -5.41980825e-02f, -3.18179876e-01f, -1.17151722e-01f, +2.43561730e-01f, +3.16850871e-01f, +1.96025148e-01f, +1.14717603e-01f, +1.32341221e-01f, -3.39897811e-01f, -2.28389576e-01f, -6.86648709e-04f, -5.62803857e-02f, -1.83192074e-01f, +1.18884891e-01f, -1.13997974e-01f, +1.99787468e-01f, -5.61220832e-02f, -1.87960565e-02f, -2.62514353e-01f, +2.54369289e-01f, +1.63806215e-01f, +1.53702140e-01f, +5.91846257e-02f, +1.36494264e-01f, +1.08694196e-01f, +2.71307658e-02f, -2.24279463e-02f, -2.16426343e-01f, +3.48414570e-01f, +1.28565669e-01f, +9.85775888e-02f, -3.24324310e-01f, -2.46362820e-01f, -2.35726342e-01f, +4.96746004e-02f, -1.71950966e-01f, +7.97653198e-03f, -2.68433094e-01f, -2.95711040e-01f, -3.06571126e-01f, -2.51014568e-02f, +1.22692905e-01f, -5.29654324e-02f, +4.19604778e-03f, +2.61349708e-01f, -1.41109422e-01f, +1.29633769e-01f, +3.26233178e-01f, -2.92473197e-01f, +2.65355319e-01f, +9.25323088e-03f, +1.57776147e-01f, +3.10218185e-01f, +1.21166378e-01f, +5.08494973e-02f, -2.00136587e-01f, -3.76424521e-01f, +1.65382192e-01f, +2.22709030e-01f, -2.26986647e-01f, +3.09276849e-01f, -1.96329847e-01f, -2.98418492e-01f, +6.05325121e-03f, -6.72512054e-02f, +2.27779120e-01f, +1.32276356e-01f, -2.31202275e-01f, -2.40972996e-01f, -2.80781239e-01f, +3.36622924e-01f, -9.96062681e-02f, -8.36995244e-03f, -4.21023577e-01f, -1.72277004e-01f, -2.14875340e-01f, +1.50592655e-01f, -8.00242424e-02f, +2.82845140e-01f, -6.58237783e-04f, -1.97404413e-03f, -3.02853793e-01f, +1.47531241e-01f, -2.85439461e-01f, -7.27638379e-02f, +2.08550394e-01f, -6.77421987e-02f, +8.89438242e-02f, +1.73956323e-02f, +1.39869958e-01f, +4.29113172e-02f, +5.28124198e-02f, -2.73309708e-01f, -1.10523008e-01f, +1.20213270e-01f, -1.03948109e-01f, +5.87104037e-02f, -4.48503077e-01f, +3.38525027e-01f, +2.49632150e-01f, +5.04667163e-02f, +2.53431685e-02f, +1.62554219e-01f, +1.37901396e-01f, -1.52372226e-01f, +4.77827817e-01f, +6.43214136e-02f, +1.42100036e-01f, +1.22275196e-01f, -2.95545489e-01f, +4.10139188e-02f, +9.48355496e-02f, +1.85893208e-01f, +1.95050031e-01f, -1.58963665e-01f, -2.97626883e-01f, -6.34663031e-02f, +2.31219858e-01f, +8.99816155e-02f, +1.06341101e-01f, -3.29703093e-01f, -2.10357174e-01f, +7.07063079e-02f, -2.13636637e-01f, -3.00075412e-02f, +1.22712821e-01f, -3.02182615e-01f, -3.19731772e-01f, +7.67594576e-03f, -2.40616836e-02f, +1.81156904e-01f, +1.91239327e-01f, -1.46503955e-01f, -3.49193394e-01f, +2.37320468e-01f, +1.63239390e-01f, +1.65108442e-02f, -2.14255720e-01f, -4.02957767e-01f, -1.18708193e-01f, -3.46189141e-01f, -1.77374259e-01f, -2.79288702e-02f, +1.78769708e-01f, -3.02265696e-02f, +5.21012545e-02f, +3.00220221e-01f, -2.59107322e-01f, +2.60151982e-01f, -9.12278593e-02f, -2.11046502e-01f, -4.13726360e-01f, -2.77029186e-01f, -4.37881231e-01f, +9.92816985e-02f, -1.54486001e-01f, +2.06314728e-01f, -2.91613072e-01f, -1.38977543e-01f, +4.48479056e-02f, +1.15567416e-01f, -1.96816196e-04f, -8.30920935e-02f, -1.74656853e-01f, -2.09242910e-01f, -1.12660974e-01f, +3.01440239e-01f, +2.40057841e-01f, +9.60293934e-02f, -2.09163234e-01f, +2.87129432e-01f, +2.60201126e-01f, +2.72428662e-01f, -3.43903713e-02f, +1.71003520e-01f, +2.99117208e-01f, -1.53938243e-02f, +2.60400087e-01f, -1.80032074e-01f, -1.40268803e-01f, -2.32511163e-01f, -2.62272626e-01f, +1.70503676e-01f, +2.16607809e-01f, +1.48115739e-01f, +7.15427548e-02f, +1.39854461e-01f, -2.83991396e-01f, -2.36603364e-01f, +2.02007473e-01f, -1.06207296e-01f, -2.65172660e-01f, +2.96815574e-01f, -1.79166436e-01f, +6.28520846e-02f, -8.32083076e-02f, -6.80292249e-02f, -2.06652265e-02f, +1.52343977e-02f, +4.10780087e-02f, -1.78960860e-01f, +1.73817977e-01f, +1.82932898e-01f, -8.83961767e-02f, -2.36979589e-01f, -6.07136562e-02f, +3.59517753e-01f, +3.27257633e-01f, +1.37410447e-01f, +5.38213961e-02f, -9.44608450e-02f, +2.66987115e-01f, -1.25075087e-01f, -2.30867907e-01f, +1.04506299e-01f, +6.30027801e-02f, -2.97184408e-01f, -1.03809297e-01f, +1.03634402e-01f, -2.31271401e-01f, -1.28367081e-01f, +2.40771770e-01f, -1.72201227e-02f, +9.75835770e-02f, +2.22183540e-01f, -2.53795177e-01f, +2.55661905e-02f, +3.34582746e-01f, +3.26445431e-01f, +1.11413874e-01f, -2.03588799e-01f, -1.94660872e-01f, -4.88460623e-02f, -1.14244977e-02f, -7.15494156e-02f, +7.84011707e-02f, +3.26700769e-02f, +1.28565207e-01f, -3.35087687e-01f, +3.20147753e-01f, -3.42160091e-02f, -7.59661198e-04f, +1.40499711e-01f, +2.34902546e-01f, +1.54468790e-01f, -1.64435446e-01f, -3.91758829e-01f, -3.50975126e-01f, +2.80895770e-01f, -5.89986026e-01f, -2.44097680e-01f, -1.51644692e-01f, +3.16419214e-01f, -2.59669662e-01f, +1.72772557e-01f, +1.52133673e-01f, -5.48478216e-02f, -9.18261558e-02f, -4.15383279e-02f, +3.63998264e-02f, +3.34181100e-01f, -3.24661255e-01f, -1.12810088e-02f, +1.88747197e-01f, -1.48598105e-01f, +1.61986083e-01f, +2.71357566e-01f, -1.98667765e-01f, -1.09197713e-01f, -2.95272633e-03f, -1.59601703e-01f, -8.94406140e-02f, +1.83286101e-01f, +2.53661901e-01f, +9.85223427e-02f, +2.85835356e-01f, +2.86903352e-01f, -3.68314803e-01f, +1.52988672e-01f, +2.40130097e-01f, +7.02273026e-02f, -3.90795022e-01f, +9.92296040e-02f, -8.09806883e-02f, +2.59119242e-01f, +1.31596327e-01f, -2.54085124e-01f, -1.87023789e-01f, -9.84806940e-03f, -2.22172737e-01f, -1.48231059e-01f, +2.43037865e-01f, -1.61473081e-01f, -2.77009338e-01f, -1.84375718e-01f, +2.36315042e-01f, -5.30664343e-03f, +2.55104434e-02f, +1.25910586e-03f, +2.36847490e-01f, +1.91168994e-01f, +1.41953140e-01f, -2.38249805e-02f, +1.48896396e-01f, -6.50654733e-02f, -2.60562003e-02f, -2.50562076e-02f, -1.05364531e-01f, -4.53026703e-04f, +1.48563400e-01f, -1.77242309e-01f, +1.82844415e-01f, +5.22484370e-02f, -3.66082549e-01f, -3.23294550e-01f, +1.94336593e-01f, +3.02809954e-01f, +2.57692099e-01f, +3.76161337e-02f, +8.73445645e-02f, +2.97364801e-01f, +8.37179571e-02f, -3.21743399e-01f, -1.99286491e-01f, +2.22121447e-01f, -2.88579583e-01f, -1.52058601e-01f, +1.49227157e-01f, -6.22843243e-02f, -2.29911748e-02f, -1.52523607e-01f, +2.09561586e-02f, -8.11331794e-02f, +2.89491862e-01f, +2.34630629e-01f, +1.05840862e-02f, +1.81624919e-01f, -9.30038095e-03f, -3.95900100e-01f, +3.57532382e-01f, -8.81689861e-02f, +1.28725141e-01f, +2.46580347e-01f, +5.58620915e-02f, -3.09258699e-01f, +2.50338286e-01f, -3.13264996e-01f, -2.31343955e-01f, +2.78763235e-01f, +1.97607964e-01f, -2.80600727e-01f, -4.26222771e-01f, -2.76969582e-01f, -4.90319282e-01f, -2.33827591e-01f, -2.31213927e-01f, -2.82220602e-01f, -4.82843250e-01f, -1.78407133e-01f, +4.19249922e-01f, +3.03812295e-01f, -1.94937631e-01f, +6.71289582e-03f, +1.59042627e-01f, +2.39801392e-01f, -2.67169327e-01f, +2.17439942e-02f, -1.18432753e-01f, -1.55137390e-01f, +2.18344703e-01f, +1.00589924e-01f, -1.73377290e-01f, +3.76521647e-01f, -1.94150031e-01f, -3.14039946e-01f, +4.22491342e-01f, +1.50374308e-01f, -1.36347532e-01f, -2.54476890e-02f, +5.69026470e-02f, -1.04810089e-01f, +1.00992925e-01f, -2.66681045e-01f, -4.96022254e-01f, +8.09314027e-02f, -1.81026489e-01f, +2.45983869e-01f, +2.09765688e-01f, -1.64191648e-01f, +2.78664052e-01f, -1.65522516e-01f, -3.34403850e-02f, +1.61413357e-01f, +1.33028477e-01f, +3.61498073e-03f, +3.14568222e-01f, +2.74222493e-01f };

static const float B_dense_5[16] = { -1.20899081e-01f, +8.67468789e-02f, -3.75403613e-02f, -2.86841709e-02f, -8.81063342e-02f, -8.92776176e-02f, +4.09868062e-02f, -9.27784815e-02f, -6.89897165e-02f, -5.91558516e-02f, +1.70825329e-02f, -1.32401451e-01f, -6.46298900e-02f, -1.07202955e-01f, -1.77239910e-01f, -2.65072048e-01f };

// layer dense_6: kernel (8 x 16), bias (8)
static const float W_dense_6[128] = { +3.59676510e-01f, +3.14272732e-01f, +4.89570409e-01f, -5.13341010e-01f, -1.29059806e-01f, +4.36485484e-02f, -8.34141910e-01f, +1.24819584e-01f, -2.27384329e-01f, +9.95769203e-02f, -8.59610558e-01f, -1.23753659e-01f, +1.55587047e-02f, +8.21114983e-03f, -3.43827814e-01f, -3.89749497e-01f, +1.32452071e-01f, -1.32519782e-01f, +2.73645133e-01f, +1.89449023e-02f, +5.57539463e-02f, -1.47136450e-02f, +6.73192292e-02f, -1.70988798e-01f, +4.25482392e-01f, -4.62896317e-01f, +1.34193655e-02f, +1.80095196e-01f, -8.70574713e-02f, +4.25187677e-01f, -1.78591132e-01f, -1.56332925e-01f, +2.27431461e-01f, +4.98136207e-02f, +1.32642895e-01f, -2.73122400e-01f, +2.29945093e-01f, -2.75349677e-01f, +4.45174962e-01f, +4.30764943e-01f, -3.50433737e-01f, +1.55793354e-01f, +4.08159435e-01f, +1.77959278e-01f, -2.57202268e-01f, +1.86633185e-01f, +1.67899251e-01f, +9.61263329e-02f, -3.55871409e-01f, -2.79140145e-01f, +1.87750775e-02f, -1.08858250e-01f, -4.35856581e-01f, +2.89950877e-01f, -3.81236196e-01f, +1.09984636e-01f, +2.72049904e-01f, +9.58060771e-02f, +3.29043716e-01f, -5.37140191e-01f, -3.89141142e-01f, -5.08917809e-01f, +2.61761963e-01f, +2.67969072e-01f, +3.94635767e-01f, +3.61101657e-01f, +1.09437317e-01f, -1.55844182e-01f, -1.45964682e-01f, +2.25204229e-01f, -1.08152717e-01f, +3.06556404e-01f, -4.69682872e-01f, -1.01335704e-01f, +1.02115899e-01f, +1.42556876e-01f, -1.14124231e-01f, +3.70431095e-01f, +3.17303687e-01f, +3.94012272e-01f, -2.64691412e-01f, +1.58769578e-01f, +2.94898152e-01f, +2.06610709e-01f, +1.70817375e-01f, -2.39688516e-01f, +1.20267838e-01f, +1.80950046e-01f, -3.46309692e-01f, -4.06946361e-01f, -5.26976943e-01f, -6.92535341e-02f, +1.80457383e-01f, -1.82120830e-01f, +4.85298038e-01f, +2.44051758e-02f, +3.56742024e-01f, -4.25097942e-01f, +5.69405556e-02f, -2.32417941e-01f, -3.25842857e-01f, -2.48154044e-01f, -3.58186141e-02f, +1.45833135e-01f, +2.32505679e-01f, -1.03068235e-03f, -7.76449889e-02f, +2.38360882e-01f, -2.16042161e-01f, -9.33834687e-02f, +1.26057625e-01f, -5.05705416e-01f, +3.31000775e-01f, +1.58154324e-01f, -4.50317144e-01f, -2.71663070e-01f, +3.89903843e-01f, -1.44698516e-01f, -4.32094365e-01f, -1.66228451e-02f, -3.35311085e-01f, +4.69090402e-01f, +4.34559315e-01f, -3.67626578e-01f, +3.16285312e-01f, -3.91525403e-02f, -1.13886893e-02f, -1.11114174e-01f };

static const float B_dense_6[8] = { +1.97103806e-02f, -8.25126246e-02f, +1.88598298e-02f, +4.00540797e-04f, +1.26041517e-01f, -4.15385291e-02f, -1.52323544e-01f, +6.96478188e-02f };

// layer dense_7: kernel (1 x 8), bias (1)
static const float W_dense_7[8] = { -9.82690528e-02f, -2.21001863e-01f, +7.82366931e-01f, +5.72856655e-03f, -1.76731244e-01f, -1.83746770e-01f, -6.41175956e-02f, -2.28180572e-01f };

static const float B_dense_7[1] = { +5.88153265e-02f };

// ---- internal buffers ----
static float input_raw[IN_SZ];
static float input_scaled[IN_SZ];
static float buf0[L0_SZ];
static float buf1[L1_SZ];
static float buf2[L2_SZ];
static float out_scaled[OUT_SZ];

// ---- helpers ----
static inline float relu(float x) { return x > 0.0f ? x : 0.0f; }

// Dense layer: out[o] = activation( sum_i weights[o*in_sz + i] * in[i] + bias[o] )
static void dense_layer(const float *in, int in_sz, const float *weights, const float *bias, int out_sz, float *out, int apply_relu) {
    for (int o = 0; o < out_sz; ++o) {
        float s = bias ? bias[o] : 0.0f;
        const float *wrow = weights + o * in_sz;
        for (int i = 0; i < in_sz; ++i) {
            s += wrow[i] * in[i];
        }
        out[o] = apply_relu ? relu(s) : s;
    }
}

// scale input from 째C -> [0,1] using notebook's MinMaxScaler
static void scale_input(const float raw[IN_SZ], float scaled[IN_SZ]) {
    for (int i = 0; i < IN_SZ; ++i) {
        scaled[i] = (raw[i] - SCALER_MIN) / SCALER_RANGE;
    }
}

// inverse scale single output value (from [0,1] -> 째C)
static float inverse_scale_output(float scaled_val) {
    return scaled_val * SCALER_RANGE + SCALER_MIN;
}

// ---- public-ish API requested: feed, run, get output ----

// Feed raw input (48 values in 째C)
void model_feed_input(const float in[IN_SZ]) {
    memcpy(input_raw, in, sizeof(input_raw));
    scale_input(input_raw, input_scaled);
}

// Execute forward pass (take input_scaled -> out_scaled)
void model_run(void) {
    // layer 0: 48 -> 32 (ReLU)
    dense_layer(input_scaled, IN_SZ, W_dense_4, B_dense_4, L0_SZ, buf0, 1);

    // layer 1: 32 -> 16 (ReLU)
    dense_layer(buf0, L0_SZ, W_dense_5, B_dense_5, L1_SZ, buf1, 1);

    // layer 2: 16 -> 8 (ReLU)
    dense_layer(buf1, L1_SZ, W_dense_6, B_dense_6, L2_SZ, buf2, 1);

    // layer 3: 8 -> 1 (linear)
    dense_layer(buf2, L2_SZ, W_dense_7, B_dense_7, OUT_SZ, out_scaled, 0);
}

// Retrieve unscaled output 째C
float model_get_output_celsius(void) {
    return inverse_scale_output(out_scaled[0]);
}

// Alternative : retrieve scaled output (0..1)
float model_get_output_scaled(void) {
    return out_scaled[0];
}

float RunInterference(float data[IN_SZ]) {
    model_feed_input(data);
    model_run();
    return model_get_output_celsius();
}

static float RunInferenceScaled_scaled(const float scaled_input[IN_SZ]) {
  memcpy(input_scaled, scaled_input, sizeof(input_scaled));
  model_run();
  return model_get_output_scaled(); // returns the output in [0..1]
}

// NextPredictions variant that works like the Python recursive loop (operates in scaled domain)
void NextPredictions_scaled_from_raw(const float data_raw[IN_SZ], int result[IN_SZ]) {
  // allocate arrays
  float* res_scaled = new float[IN_SZ];         // holds scaled sequence, mutated
  float* out_denorm = new float[IN_SZ];         // final denormalized predictions to return

  // init scaled buffer from raw input
  for (size_t i = 0; i < IN_SZ; ++i) res_scaled[i] = (data_raw[i] - SCALER_MIN) / SCALER_RANGE;

  for (size_t step = 0; step < IN_SZ; ++step) {
    float next_scaled = RunInferenceScaled_scaled(res_scaled);

    // shift left
    for (size_t i = 1; i < IN_SZ; ++i) res_scaled[i - 1] = res_scaled[i];

    // append predicted scaled value
    res_scaled[IN_SZ - 1] = next_scaled;

    // also store the denormalized prediction in out_denorm[step]
    out_denorm[step] = next_scaled * SCALER_RANGE + SCALER_MIN;
  }

  // Print for debug
  Serial.println("Predictions (denorm):");
  for (size_t i = 0; i < IN_SZ; ++i) {
    Serial.print("  out[");
    Serial.print(i);
    Serial.print("] = ");
    Serial.println(out_denorm[i], 6);
  }

  for (size_t i = 0; i < IN_SZ; ++i) result[i] = int(out_denorm[i]);

  delete[] res_scaled; // free temp
  delete[] out_denorm;   // caller must delete[] when done
}


void setup() {

    Serial.begin(9600);
    while (!Serial) { delay(1); }

    Serial.println("\nIn setup()\n\n");
    pinMode(LEDR, OUTPUT);
    pinMode(LEDG, OUTPUT);
    pinMode(LEDB, OUTPUT);
    applyColor(0, 0, 128);

    dht.begin();
    Serial.println("DHT has began");    
    
    // INITIALIZE the 2 arrays
    float intial_array[] = { // initial data to set up model inputs, typically the last 48 records (=24h)
        13.3,13.1,12.8,12.6,12.0,11.9,12.2,12.8,14.2,15.5,16.3,
        16.8,16.9,16.9,16.6,16.3,15.7,14.8,14.2,13.8,13.9,13.5,
        13.0,12.6,12.4,12.1,12.1,11.9,11.7,11.8,12.7,13.1,13.8,
        14.5,15.0,15.6,15.6,15.7,15.8,15.8,15.6,15.0,14.2,13.9,
        13.6,13.1,13.0,12.9
    };

    Serial.println("initializing array");    

    for (size_t i = 0 ; i < IN_SZ ; ++i){
        previous_temperature[i] = intial_array[i];
        next_temperature[i] = 0x00; // example value
    }
    Serial.println("array initialized");    

    applyColor(0, 0, 255);
    Serial.println("Service is running !");
}

void loop() {
    size_t cpt = 0;
    applyColor(0, 0, 0);
    while(1){
        Serial.println("[SEN] Reading sensors");

        temp = int(dht.readTemperature());
        // add temp to previous_temp
        for (size_t i = 2 ; i < IN_SZ ; ++i) previous_temperature[i-1] = previous_temperature[i];
        
        float f_argument[IN_SZ];
        for (size_t i = 0 ; i < IN_SZ ; ++i) f_argument[i] = float(previous_temperature[i]); // cast to float
        // from previous_temp, recompute next_temp (we must recompute it each time).
        NextPredictions_scaled_from_raw(f_argument, next_temperature);

        Serial.print("cpt: ");
        Serial.println(cpt);
        cpt++;

        // display arrays
        Serial.println("previous_temperature:");
        for (size_t i = 0; i < IN_SZ; i++) {
            Serial.print(previous_temperature[i]);
            if ((i + 1) % 12 == 0) Serial.println();
            else Serial.print(", ");
        }
        Serial.println();

        Serial.println("next_temperature:");
        for (size_t i = 0; i < IN_SZ; i++) {
            Serial.print(next_temperature[i]);
            if ((i + 1) % 12 == 0) Serial.println();
            else Serial.print(", ");
        }
        Serial.println();

        for(size_t sec = 0 ; sec < SAMPLING_INTERVAL*60 ; ++sec){
            delay(900);
            applyColor(25, 125, 35);
            delay(100);
            applyColor(0, 0, 0);
        }

    }
}

inline void applyColor(int r, int g, int b) {
  analogWrite(LEDR, 255 - r);
  analogWrite(LEDG, 255 - g);
  analogWrite(LEDB, 255 - b);
}